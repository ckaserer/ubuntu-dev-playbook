---
- name: install dep for freon extension
  apt: 
    name:
      - lm-sensors # freon
      - x11-utils # No Title Bar

- name: run sensor detect for freon extension
  command: sensors-detect --auto

- name: Create extension directories
  file:
    path: "{{ gnome_extensions_path }}/{{ extension.uuid }}"
    state: directory  
  become: true
  become_user: "{{ user }}"
  loop_control:
    loop_var: extension
    label: "{{ extension.setting }}"
  with_items: "{{ gnome_extensions }}"

- name: Download extensions
  unarchive:
    src: "{{ extension.src }}"
    dest: "{{ gnome_extensions_path }}/{{ extension.uuid }}"
    remote_src: yes
  become: true
  become_user: "{{ user }}"
  loop_control:
    loop_var: extension
    label: "{{ extension.setting }}"
  with_items: "{{ gnome_extensions }}"
    
- name: Enable extensions
  shell: "gsettings set org.gnome.shell enabled-extensions \"$(gsettings get org.gnome.shell enabled-extensions | sed s/.$//), '{{ extension.uuid }}']\""
  become: true
  become_user: "{{ user }}"
  loop_control:
    loop_var: extension
    label: "{{ extension.setting }}"
  with_items: "{{ gnome_extensionsÂ }}"

- name: Configure extensions
  include_tasks: tasks/configure-gnome-extensions.yml
  loop_control:
    loop_var: extension
    label: "{{ extension.setting }}"
  with_items: "{{ gnome_extensions }}"

- name: restart gdm3
  service:
    name: gdm3
    state: restarted
...
